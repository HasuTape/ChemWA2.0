<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ChemWA 2.0</title>
  <style>
    :root {
      --bg: #0f0b1a;
      --fg: #e8e6ff;
      --purple: #6c4fef;
      --purple-2: #3a2a8f;
      --cyan: #27e1e8;
      --cyan-2: #11aab0;
      --muted: #b7b3d8;
      --radius: 14px;
      --gap: 16px;
      --panel: #141025;
      --panel-2: #181233;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 800px at 10% 10%, rgba(108,79,239,0.12), transparent 60%),
                  radial-gradient(900px 600px at 90% 20%, rgba(39,225,232,0.12), transparent 60%),
                  var(--bg);
      /* Zapobiegaj zapętleniu tła przy długich stronach */
      background-repeat: no-repeat, no-repeat;
      background-attachment: fixed, fixed;
      background-position: 10% 10%, 90% 20%;
      background-size: 1200px 800px, 900px 600px;
      color: var(--fg);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    }

    .spoiler
    {
      background-color: rgb(58, 58, 58);
      color: rgb(58, 58, 58);
    }
    .spoiler:hover
    {
      color: white;
      background-color: transparent;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: saturate(140%) blur(8px);
      background: linear-gradient(180deg, rgba(20,16,37,0.9), rgba(20,16,37,0.75));
      border-bottom: 1px solid rgba(108,79,239,0.25);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px clamp(16px, 4vw, 24px);
    }

    .brand { display: flex; align-items: center; gap: 12px; user-select: none; }
    .logo {
      width: 36px; height: 36px; border-radius: 10px;
      background: conic-gradient(from 210deg, var(--cyan), var(--purple));
      box-shadow: inset 0 0 20px rgba(255,255,255,0.15), 0 6px 18px rgba(108,79,239,0.35);
    }
    h1 { margin: 0; font-size: clamp(20px, 3vw, 28px); letter-spacing: 0.5px; font-weight: 700; color: var(--fg); }

    .layout { display: grid; grid-template-columns: 1fr minmax(260px, 320px); gap: var(--gap); align-items: start; }

    .panel {
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border: 1px solid rgba(39,225,232,0.18);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .content-header, .sidebar-header {
      padding: 14px 16px;
      border-bottom: 1px solid rgba(108,79,239,0.25);
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      background: linear-gradient(180deg, rgba(108,79,239,0.12), transparent);
    }

    .content-title, .sidebar-title { margin: 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1.2px; color: var(--muted); }

    .content { min-height: 60vh; padding: 18px; }

    .lesson-title { margin: 0; font-weight: 600; color: var(--cyan); font-size: 15px; letter-spacing: 0.3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 60%; }

    .sidebar { display: flex; flex-direction: column; }
    .sidebar-body { padding: 12px; display: grid; grid-template-columns: 1fr; gap: 10px; }

    .btn {
      appearance: none;
      border: 1px solid rgba(39,225,232,0.25);
      background: linear-gradient(180deg, rgba(39,225,232,0.08), rgba(108,79,239,0.08));
      color: var(--fg);
      padding: 10px 12px; border-radius: 10px; font-weight: 600; letter-spacing: 0.2px; cursor: pointer;
      transition: transform 0.05s ease, box-shadow 0.2s ease, border-color 0.2s ease, background 0.2s ease;
      text-align: left;
    }
    .btn:hover { border-color: var(--cyan); box-shadow: 0 6px 20px rgba(39,225,232,0.15); background: linear-gradient(180deg, rgba(39,225,232,0.12), rgba(108,79,239,0.12)); }
    .btn:active { transform: translateY(1px); }
    .btn .meta { display: block; font-weight: 500; color: var(--muted); font-size: 12px; margin-top: 2px; }

    .status { display: inline-flex; align-items: center; gap: 8px; font-size: 12px; color: var(--muted); }
    .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--purple); box-shadow: 0 0 10px var(--purple); }

    .placeholder { color: var(--muted); font-size: 15px; }

    @media (max-width: 900px) { .layout { grid-template-columns: 1fr; } }

    /* ——— Przełączniki i ustawienia ——— */
    .toggle-wrap { position: fixed; right: 12px; bottom: 12px; z-index: 1000; }
    .tri-switch {
      appearance: none; -webkit-appearance: none;
      width: 44px; height: 26px; border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.2);
      background: #aaa; color: #111;
      font-weight: 800; font-size: 14px; line-height: 1;
      display: inline-flex; align-items: center; justify-content: center;
      cursor: pointer; user-select: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      transition: background .2s ease, color .2s ease;
    }
    
    .settings-panel {
      position: fixed; right: 12px; bottom: 80px; z-index: 1000;
      background: var(--panel); border: 1px solid rgba(39,225,232,0.18);
      border-radius: var(--radius); padding: 16px; min-width: 200px;
      box-shadow: var(--shadow);
    }
    .setting-item { margin-bottom: 12px; }
    .setting-item label { display: block; margin-bottom: 4px; font-size: 14px; }
    .setting-item select, .setting-item button { width: 100%; padding: 6px; border-radius: 6px; }
    
    /* Motywy */
    body.light-theme {
      --bg: #ffffff;
      --fg: #1a1a1a;
      --panel: #f8f9fa;
      --panel-2: #e9ecef;
      --muted: #6c757d;
    }
    
    .no-colors .P, .no-colors .S, .no-colors .W, .no-colors .N,
    .no-colors .PS, .no-colors .PW, .no-colors .PN,
    .no-colors .WS, .no-colors .SN, .no-colors .WN {
      color: inherit !important;
    }

    /* Widoczność klas w zależności od poziomu */
    .P, .S, .W, .N, .PS, .PW, .WS, .PN, .SN, .WN { display: none !important; }
    .level-P .P, .level-P .PS, .level-P .PW, .level-P .PN { display: initial !important; }
    .level-S .S, .level-S .PS, .level-S .WS, .level-S .SN { display: initial !important; }
    .level-W .W, .level-W .PW, .level-W .WS, .level-W .WN { display: initial !important; }
    .level-N .W, .level-N .N, .level-N .PW, .level-N .WS, .level-N .WN { display: initial !important; }
    
    /* Kolory dla różnych poziomów trudności */
    .P { color: #4ade80 !important; }
    .S { color: #ffd166 !important; }
    .W { color: #ff5b6e !important; }
    .N { color: #3b82f6 !important; }
    /* Kombinacje - kolor najniższego poziomu */
    .PS { color: #4ade80 !important; }
    .PW { color: #4ade80 !important; }
    .PN { color: #4ade80 !important; }
    .WS { color: #ffd166 !important; }
    .SN { color: #ffd166 !important; }
    .WN { color: #ff5b6e !important; }
    
    /* Zagnieżdżone klasy - większa specyficzność */
    .P .P, .P .PS, .P .PW, .P .PN { color: #4ade80 !important; }
    .S .S, .S .PS, .S .WS, .S .SN { color: #ffd166 !important; }
    .W .W, .W .PW, .W .WS, .W .WN { color: #ff5b6e !important; }
    .N .N, .N .PN, .N .SN, .N .WN { color: #3b82f6 !important; }
    
    /* Najwyższa specyficzność dla głęboko zagnieżdżonych */
    .P .S .W .N, .S .W .N, .W .N { color: #3b82f6 !important; }
    .P .S .W, .S .W { color: #ff5b6e !important; }
    .P .S { color: #ffd166 !important; }
  </style>
</head>
<body>
  <header>
    <div class="container brand">
      <div class="logo" aria-hidden="true"></div>
      <h1>ChemWA 2.0</h1>
    </div>
  </header>

  <!-- Przełącznik 3‑stanowy (pod → śre → wyż) -->
  <div class="toggle-wrap">
    <button id="levelSwitch" class="tri-switch" aria-label="Poziom: Pod (ukryte)" title="Poziom: Pod (ukryte)">P</button>
    <button id="settingsBtn" class="tri-switch" style="margin-left: 8px;" title="Ustawienia">⚙</button>
  </div>

  <!-- Panel ustawień -->
  <div id="settingsPanel" class="settings-panel" style="display: none;">
    <h3>Ustawienia</h3>
    <div class="setting-item">
      <label>Motyw:</label>
      <select id="themeSelect">
        <option value="system">Systemowy</option>
        <option value="dark">Ciemny</option>
        <option value="light">Jasny</option>
      </select>
    </div>
    <div class="setting-item">
      <label>
        <input type="checkbox" id="colorToggle"> Kolorowanie poziomów trudności
      </label>
    </div>
    <div class="setting-item">
      <button onclick="window.location.href='mailto:kontakt.chemwa@gmail.com?subject=Zgłoszenie błędu - ChemWA 2.0'">Zgłoś błąd</button>
    </div>
  </div>

  <main class="container">
    <div class="layout">
      <section class="panel" aria-label="Panel treści">
        <div class="content-header">
          <h2 class="content-title">Zawartość lekcji</h2>
          <div class="status">
            <span class="dot" id="status-dot"></span>
            <span id="status-text">Brak wybranej lekcji</span>
          </div>
        </div>
        <div id="lesson-container" class="content" role="region" aria-live="polite">
          <p class="placeholder">Wybierz lekcję z panelu po prawej, aby wyświetlić jej treść.</p>
        </div>
      </section>

      <aside class="panel sidebar" aria-label="Panel wyboru lekcji">
        <div class="sidebar-header">
          <h2 class="sidebar-title">Temat</h2>
          <strong class="lesson-title" id="current-topic">—</strong>
        </div>
        <div class="sidebar-body">
          <button class="btn" data-file="zbpwl.html" data-topic="Zasady bezpiecznej pracy w laboratorium">
            Zasady bezpiecznej pracy w laboratorium
          </button>
          <button class="btn" data-file="ws.html" data-topic="Właściwości substancji">
            Właściwości substancji
          </button>
          <button class="btn" data-file="d.html" data-topic="Gęstość substancji">
            Gęstość substancji
          </button>
          <button class="btn" data-file="rmiir.html" data-topic="Rodzaje mieszanin i ich rozdzielanie">
            Rodzaje mieszanin i ich rozdzielanie
          </button>
          <button class="btn" data-file="zfarc.html" data-topic="Zjawisko fizyczne a reakcja chemiczna">
            Zjawisko fizyczne a reakcja chemiczna
          </button>
          <button class="btn" data-file="rrc.html" data-topic="Rodzaje reakcji chemicznych">
            Rodzaje reakcji chemicznych
          </button>
          <button class="btn" data-file="bm.html" data-topic="Budowa materii">
            Budowa materii
          </button>
        </div>
      </aside>
    </div>
  </main>

  <script>
    // ——— 3‑stanowy przełącznik: pod -> śre -> wyż ———
    (function () {
      const LEVELS = ['P', 'S', 'W', 'N'];
      const STORAGE_KEY = 'visibility-level';
      const btn = document.getElementById('levelSwitch');

      const ui = {
        P: { text: 'P', bg: '#4ade80', fg: '#0b3017', label: 'Podstawowy' },
        S: { text: 'S', bg: '#ffd166', fg: '#111', label: 'Średni' },
        W: { text: 'W', bg: '#ff5b6e', fg: '#fff', label: 'Wysoki' },
        N: { text: 'N', bg: 'linear-gradient(45deg, #27e1e8, #8a2be2)', fg: '#fff', label: 'Najwyższy' },
      };

      function updateButton(level) {
        const s = ui[level];
        btn.textContent = s.text;
        btn.style.background = s.bg;
        btn.style.color = s.fg;
        btn.setAttribute('data-level', level);
        const label = `Poziom: ${s.label}`;
        btn.setAttribute('aria-label', label);
        btn.title = label;
      }

      function applyLevel(level) {
        document.body.classList.remove('level-P', 'level-S', 'level-W', 'level-N');
        document.body.classList.add(`level-${level}`);
        updateButton(level);
      }

      function nextLevel(cur) {
        const i = LEVELS.indexOf(cur);
        return LEVELS[(i + 1) % LEVELS.length];
      }

      function init() {
        let level = localStorage.getItem(STORAGE_KEY) || 'P';
        if (!LEVELS.includes(level)) level = 'P';
        applyLevel(level);
        btn.addEventListener('click', () => {
          level = nextLevel(level);
          applyLevel(level);
          localStorage.setItem(STORAGE_KEY, level);
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>

  <script>
    // ——— Ładowanie lekcji do kontenera ———
    (function () {
      const container = document.getElementById('lesson-container');
      const currentTopic = document.getElementById('current-topic');
      const statusText = document.getElementById('status-text');
      const statusDot = document.getElementById('status-dot');

      function setStatus(text, color = 'var(--purple)') {
        statusText.textContent = text;
        statusDot.style.background = color;
        statusDot.style.boxShadow = `0 0 10px ${color}`;
      }

      async function loadLesson(file, topic) {
        currentTopic.textContent = topic || '—';
        setStatus('Ładowanie…', 'var(--cyan)');
        try {
          const res = await fetch(file, { cache: 'no-cache' });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const html = await res.text();
          container.innerHTML = html;
          setStatus('Załadowano');
        } catch (err) {
          console.error(err);
          container.innerHTML = `<p class="placeholder">Nie udało się załadować pliku: <code>${file}</code>.<br>Sprawdź, czy plik istnieje i czy jest dostępny przez serwer http.</p>`;
          setStatus('Błąd', '#ff5b6e');
        }
      }

      document.addEventListener('click', (e) => {
        const btn = e.target.closest('.btn[data-file]');
        if (!btn) return;
        const file = btn.getAttribute('data-file');
        const topic = btn.getAttribute('data-topic');
        loadLesson(file, topic);
      });
    })();
    
    // ——— Ustawienia ———
    (function() {
      const settingsBtn = document.getElementById('settingsBtn');
      const settingsPanel = document.getElementById('settingsPanel');
      const themeSelect = document.getElementById('themeSelect');
      const colorToggle = document.getElementById('colorToggle');
      
      settingsBtn.addEventListener('click', () => {
        settingsPanel.style.display = settingsPanel.style.display === 'none' ? 'block' : 'none';
      });
      
      // Motyw
      const savedTheme = localStorage.getItem('theme') || 'system';
      themeSelect.value = savedTheme;
      applyTheme(savedTheme);
      
      themeSelect.addEventListener('change', (e) => {
        const theme = e.target.value;
        localStorage.setItem('theme', theme);
        applyTheme(theme);
      });
      
      function applyTheme(theme) {
        document.body.classList.remove('light-theme');
        if (theme === 'light') {
          document.body.classList.add('light-theme');
        } else if (theme === 'system') {
          if (window.matchMedia('(prefers-color-scheme: light)').matches) {
            document.body.classList.add('light-theme');
          }
        }
      }
      
      // Kolorowanie
      const savedColors = localStorage.getItem('difficulty-colors') === 'true';
      colorToggle.checked = savedColors;
      if (!savedColors) document.body.classList.add('no-colors');
      
      colorToggle.addEventListener('change', (e) => {
        const enabled = e.target.checked;
        localStorage.setItem('difficulty-colors', enabled);
        if (enabled) {
          document.body.classList.remove('no-colors');
        } else {
          document.body.classList.add('no-colors');
        }
      });
    })();
  </script>
</body>
</html>